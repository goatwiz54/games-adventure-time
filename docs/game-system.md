# ダンジョン探索RPG ゲーム設計仕様書 (Ver 2.0)

## 1. 基本システム概要
*   **視点:** クォータービュー（斜め見下ろし型・高低差あり）
*   **進行:** ターン制グリッド移動
*   **世界観:** 資源管理と時間の概念が厳しいローグライクRPG
*   **画作り:** プロシージャル生成によるドット絵風テクスチャ（草、土、石など）

---

## 2. 操作方法（Input Mapping）

| キー入力 | 機能 | 詳細 |
| :--- | :--- | :--- |
| **矢印キー** | 移動 | カーソル方向へ1マス移動する。移動アニメーションあり。時間が経過する。 |
| **Shift + 矢印** | 方向転換 | その場で向きだけを変える。移動はしない。時間は通常の1/10しか経過しない。 |
| **Ctrl + 矢印** | カメラ操作 | プレイヤーを動かさず、カメラ（視点）だけを移動させる。時間は経過しない。 |
| **F12** | ズーム拡大 | 画面を拡大する（0.8倍 → 0.9倍 ... → 1.5倍）。 |
| **Shift + F12** | ズーム縮小 | 画面を縮小する（... 0.9倍 → 0.8倍 → 0.7倍）。 |
| **F1** | デバッグ表示 | マップ全域と敵の位置を強制表示する（ON/OFF）。OFFに戻すと未探索エリアは暗闇に戻る。 |
| **R** | 戦闘リセット | （プロトタイプ用）戦闘状態を強制解除し、隣接する敵を消去する。 |

---

## 3. 時間とターンの概念
このゲームの最も重要なリソースは「時間」です。

*   **基本時間単位:** 1アクション（移動など） ＝ **6分**
*   **カレンダー:** 1日 ＝ 朝・昼・晩、1年 ＝ 360日
*   **探索WT（ウェイトターン）:** パーティ全員の平均WT。これが高いほど、戦闘時の行動順が遅くなるが、探索時の1歩あたりの時間経過は「6分 × 重量ペナルティ」で固定される。

---

## 4. キャラクター・ステータス詳細

### 4.1 構成要素
| 項目 | 説明 | 備考 |
| :--- | :--- | :--- |
| **名前/種族/職業** | 基本プロフィール | 人間、エルフ、ドワーフなど |
| **年齢** | 12歳～100歳 | 加齢によるステータス変化（未実装だが枠あり） |
| **Level** | 10～20 (上限) | **隠しパラメータ**。初期状態では見えない。 |

### 4.2 レベルキャップ（潜在能力）の出現確率
キャラメイク時にランダムで「最大レベル」が決定される。

| 最大レベル | 出現確率 | 備考 |
| :--- | :--- | :--- |
| Lv 10 | 3.00% | 不遇 |
| Lv 11 | 0.01% | 超不遇 |
| Lv 12 | 0.10% | |
| Lv 13 | 3.00% | |
| Lv 14 | 15.00% | |
| **Lv 15** | **62.78%** | **一般的** |
| Lv 16 | 10.00% | 有望 |
| Lv 17 | 5.00% | |
| Lv 18 | 1.00% | |
| Lv 19 | 0.10% | 英雄候補 |
| Lv 20 | 0.01% | 伝説 |

### 4.3 WT (Wait Time) 計算式
行動順と行動頻度を決定する最重要パラメータ。低いほど速い。

*   **Base WT (基礎値):** 275 ～ 325 (中央値 300)
    *   キャラ作成時にランダム決定。一生変わらない。
*   **Game WT (実効値) 計算式:**
    $$GameWT = BaseWT + \lceil 総重量 \rceil - \lfloor AGI \times 2.5 \rfloor - (INT \times 2)$$
    *   ※計算結果が1未満の場合は、**1**とする。

**【計算例】**
*   **重戦士:** Base 310, 重量 40kg, AGI 10, INT 8
    *   $310 + 40 - 25 - 16 = 309$ (遅い)
*   **盗賊:** Base 280, 重量 5kg, AGI 18, INT 12
    *   $280 + 5 - 45 - 24 = 216$ (速い、戦士が2回動く間に3回動ける)

---

## 5. インベントリと重量ペナルティ
「持てる量」と「重さ」は別管理され、重すぎると時間の経過が加速する。

### 5.1 容量計算
*   **スロット数（マス）:** $(VIT \times 3) + DEX$
*   **最大積載量（kg）:** $STR \times 5$

### 5.2 重量ペナルティ係数表
現在重量が最大積載量の何％かによって、**「1歩歩くのにかかる時間」**が増大する。

| 重量比率 (%) | ペナルティ係数 | 1歩の時間経過 |
| :--- | :--- | :--- |
| **0% ～ 84.9%** | **1.0倍** | 6分 (標準) |
| **85% ～ 89.9%** | **1.1倍** | 6.6分 |
| **90% ～ 94.9%** | **1.2倍** | 7.2分 |
| **95% ～ 99.9%** | **1.4倍** | 8.4分 |
| **100%以上** | **2.0倍** | 12分 (激重) |

---

## 6. ダンジョン・探索システム

### 6.1 視界システム (Fog of War)
キャラクターの向きによって見える範囲が異なる「指向性視界」。
視認判定は**マンハッタン距離** $(|dx| + |dy|)$ に以下の補正を加えて判定する。

*   **方向補正:**
    *   **前方:** 距離計算結果から **-2** (2マス遠くまで見える)
    *   **側面:** 距離計算結果から **-1** (1マス遠くまで見える)
    *   **後方:** 距離計算結果から **+1** (近くしか見えない)

*   **視認ランク:**
    | 補正後距離 | 状態 | 画面表示 |
    | :--- | :--- | :--- |
    | **2以下** | Clear | 鮮明に見える。敵の識別可能。 |
    | **3** | Dim | 薄暗い。地形はわかる。 |
    | **4** | Vague | シルエット。何かあるかも？ |
    | **5以上** | Dark | 真っ暗。見えない。 |

*   **記憶 (Explored):** 一度「Clear～Vague」になったタイルは、視界外になっても「記憶領域」としてグレーアウト状態で表示され続ける。

### 6.2 移動・地形
*   **高低差:** タイルごとに高さ(Height)を持つ。隣接していても高さの差が**2以上**ある場合は移動できない（壁となる）。
*   **アニメーション:** 移動時、論理座標は即座に更新されるが、描画座標は線形補間（Lerp）により滑らかに移動する。
*   **移動コスト:**
    *   **通常移動:** 探索WT × 1.0 (時間: 6分×重量係数)
    *   **方向転換:** 探索WT × 0.1 (時間: 0.6分×重量係数)

---

## 7. 敵AI・戦闘システム

### 7.1 敵のステータス
*   **Type A:** 通常移動 (1ターン1マス)
*   **Type B:** 高速移動 (1ターン2マス)
*   **Facing:** 敵も「向き」を持つ。移動した方向へ向く。

### 7.2 AIロジック (確率テーブル)
プレイヤーとの距離に応じて行動確率が変動する。

| 距離 (視界) | 追跡 (Chase) | 停止 (Stop) | ランダム (Random) |
| :--- | :--- | :--- | :--- |
| **近距離 (≦2)** | 55% | 30% | 15% |
| **遠距離 (3～4)** | 5% | 15% | 80% |
| **視界外 (5≦)** | 0% | 0% | 100% |

*   **※調整点:** 以前より「停止」の確率を1.5倍に引き上げ、プレイヤーが戦略を練る隙を作った。

### 7.3 接敵と戦闘
*   **判定:** プレイヤーまたは敵が移動した結果、**距離が1以下（重なる or 隣接）**になった瞬間。
*   **処理:**
    1.  画面に「ENCOUNTER!」を表示。
    2.  移動操作をロック。
    3.  戦闘モードへ移行（現在はプロトタイプのためRキーで解決）。

---

## 8. 経済・世界設定（設定資料）

### 8.1 通貨
国ごとに異なる通貨が存在し、レート変動がある。
*   **サンガード:** ガルド
*   **シルバーフォレスト:** エルム
*   **ハイクリフ:** ガレ
*   **アクアロード:** イリス
*   **ルナリア:** ノクト

### 8.2 都市間移動コスト
街から街への移動は「探索ターン」ではなく「日数」計算となる。
*   **計算式:** `(基本日数 * 24h + 基本時間) * 10ターン`
*   **負荷:** ここにも重量ペナルティ係数が掛かる（荷物が重いと、到着まで数日遅れる）。